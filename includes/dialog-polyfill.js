'use strict';(function(l,n){"object"===typeof exports&&"undefined"!==typeof module?module.exports=n():"function"===typeof define&&define.amd?define(n):(l=l||self,l.dialogPolyfill=n())})(this,function(){function l(a,b){var c="on"+b.type.toLowerCase();if("function"===typeof a[c])a[c](b);return a.dispatchEvent(b)}function n(a){for(;a&&a!==document.body;){var b=window.getComputedStyle(a),c=function(f,g){return!(void 0===b[f]||b[f]===g)};if(1>b.opacity||c("zIndex","auto")||c("transform","none")||c("mixBlendMode",
"normal")||c("filter","none")||c("perspective","none")||"isolate"===b.isolation||"fixed"===b.position||"touch"===b.webkitOverflowScrolling)return!0;a=a.parentElement}return!1}function p(a){for(;a;){if("dialog"===a.localName)return a;a=a.parentElement?a.parentElement:a.parentNode?a.parentNode.host:null}return null}function r(a){for(;a&&a.shadowRoot&&a.shadowRoot.activeElement;)a=a.shadowRoot.activeElement;a&&a.blur&&a!==document.body&&a.blur()}function q(a){return a&&a.hasAttribute("method")?"dialog"===
a.getAttribute("method").toLowerCase():!1}function t(a){var b=["button","input","keygen","select","textarea"].map(function(f){return f+":not([disabled])"});b.push('[tabindex]:not([disabled]):not([tabindex=""])');b=a.querySelector(b.join(", "));if(!b&&"attachShadow"in Element.prototype){a=a.querySelectorAll("*");for(var c=0;c<a.length&&!(a[c].tagName&&a[c].shadowRoot&&(b=t(a[c].shadowRoot)));c++);}return b}function u(a){return a.isConnected||document.body.contains(a)}function v(a){if(a.submitter)return a.submitter;
var b=a.target;if(!(b instanceof HTMLFormElement))return null;var c=d.formSubmitter;c||(a=a.target,c=("getRootNode"in a&&a.getRootNode()||document).activeElement);return c&&c.form===b?c:null}function x(a){if(!a.defaultPrevented){var b=a.target,c=d.imagemapUseValue,f=v(a);null===c&&f&&(c=f.value);var g=p(b);g&&"dialog"===(f&&f.getAttribute("formmethod")||b.getAttribute("method"))&&(a.preventDefault(),null!=c?g.close(c):g.close())}}function w(a){this.dialog_=a;this.openAsModal_=this.replacedStyleTop_=
!1;a.hasAttribute("role")||a.setAttribute("role","dialog");a.show=this.show.bind(this);a.showModal=this.showModal.bind(this);a.close=this.close.bind(this);a.addEventListener("submit",x,!1);"returnValue"in a||(a.returnValue="");if("MutationObserver"in window)(new MutationObserver(this.maybeHideModal.bind(this))).observe(a,{attributes:!0,attributeFilter:["open"]});else{var b=!1,c=function(){b?this.downgradeModal():this.maybeHideModal();b=!1}.bind(this),f,g=function(e){e.target===a&&(b|="DOMNodeRemoved"===
e.type.substr(0,14),window.clearTimeout(f),f=window.setTimeout(c,0))};["DOMAttrModified","DOMNodeRemoved","DOMNodeRemovedFromDocument"].forEach(function(e){a.addEventListener(e,g)})}Object.defineProperty(a,"open",{set:this.setOpen.bind(this),get:a.hasAttribute.bind(a,"open")});this.backdrop_=document.createElement("div");this.backdrop_.className="backdrop";this.backdrop_.addEventListener("mouseup",this.backdropMouseEvent_.bind(this));this.backdrop_.addEventListener("mousedown",this.backdropMouseEvent_.bind(this));
this.backdrop_.addEventListener("click",this.backdropMouseEvent_.bind(this))}var m=window.CustomEvent;m&&"object"!==typeof m||(m=function(a,b){b=b||{};var c=document.createEvent("CustomEvent");c.initCustomEvent(a,!!b.bubbles,!!b.cancelable,b.detail||null);return c},m.prototype=window.Event.prototype);w.prototype={get dialog(){return this.dialog_},maybeHideModal:function(){this.dialog_.hasAttribute("open")&&u(this.dialog_)||this.downgradeModal()},downgradeModal:function(){this.openAsModal_&&(this.openAsModal_=
!1,this.dialog_.style.zIndex="",this.replacedStyleTop_&&(this.dialog_.style.top="",this.replacedStyleTop_=!1),this.backdrop_.parentNode&&this.backdrop_.parentNode.removeChild(this.backdrop_),d.dm.removeDialog(this))},setOpen:function(a){a?this.dialog_.hasAttribute("open")||this.dialog_.setAttribute("open",""):(this.dialog_.removeAttribute("open"),this.maybeHideModal())},backdropMouseEvent_:function(a){if(this.dialog_.hasAttribute("tabindex"))this.dialog_.focus();else{var b=document.createElement("div");
this.dialog_.insertBefore(b,this.dialog_.firstChild);b.tabIndex=-1;b.focus();this.dialog_.removeChild(b)}b=document.createEvent("MouseEvents");b.initMouseEvent(a.type,a.bubbles,a.cancelable,window,a.detail,a.screenX,a.screenY,a.clientX,a.clientY,a.ctrlKey,a.altKey,a.shiftKey,a.metaKey,a.button,a.relatedTarget);this.dialog_.dispatchEvent(b);a.stopPropagation()},focus_:function(){var a=this.dialog_.querySelector("[autofocus]:not([disabled])");!a&&0<=this.dialog_.tabIndex&&(a=this.dialog_);a||(a=t(this.dialog_));
r(document.activeElement);a&&a.focus()},updateZIndex:function(a,b){if(a<b)throw Error("dialogZ should never be < backdropZ");this.dialog_.style.zIndex=a;this.backdrop_.style.zIndex=b},show:function(){this.dialog_.open||(this.setOpen(!0),this.focus_())},showModal:function(){if(this.dialog_.hasAttribute("open"))throw Error("Failed to execute 'showModal' on dialog: The element is already open, and therefore cannot be opened modally.");if(!u(this.dialog_))throw Error("Failed to execute 'showModal' on dialog: The element is not in a Document.");
if(!d.dm.pushDialog(this))throw Error("Failed to execute 'showModal' on dialog: There are too many open modal dialogs.");n(this.dialog_.parentElement)&&console.warn("A dialog is being shown inside a stacking context. This may cause it to be unusable. For more information, see this link: https://github.com/GoogleChrome/dialog-polyfill/#stacking-context");this.setOpen(!0);this.openAsModal_=!0;d.needsCentering(this.dialog_)?(d.reposition(this.dialog_),this.replacedStyleTop_=!0):this.replacedStyleTop_=
!1;this.dialog_.parentNode.insertBefore(this.backdrop_,this.dialog_.nextSibling);this.focus_()},close:function(a){if(!this.dialog_.hasAttribute("open"))throw Error("Failed to execute 'close' on dialog: The element does not have an 'open' attribute, and therefore cannot be closed.");this.setOpen(!1);void 0!==a&&(this.dialog_.returnValue=a);a=new m("close",{bubbles:!1,cancelable:!1});l(this.dialog_,a)}};var d={reposition:function(a){var b=document.body.scrollTop||document.documentElement.scrollTop;
a.style.top=Math.max(b,b+(window.innerHeight-a.offsetHeight)/2)+"px"},isInlinePositionSetByStylesheet:function(a){for(var b=0;b<document.styleSheets.length;++b){var c=document.styleSheets[b],f=null;try{f=c.cssRules}catch(y){}if(f)for(c=0;c<f.length;++c){var g=f[c],e=null;try{e=document.querySelectorAll(g.selectorText)}catch(y){}var k;if(!(k=!e)){a:{for(k=0;k<e.length;++k)if(e[k]===a){e=!0;break a}e=!1}k=!e}if(!k&&(e=g.style.getPropertyValue("top"),g=g.style.getPropertyValue("bottom"),e&&"auto"!==
e||g&&"auto"!==g))return!0}}return!1},needsCentering:function(a){return"absolute"!==window.getComputedStyle(a).position||"auto"!==a.style.top&&""!==a.style.top||"auto"!==a.style.bottom&&""!==a.style.bottom?!1:!d.isInlinePositionSetByStylesheet(a)},forceRegisterDialog:function(a){(window.HTMLDialogElement||a.showModal)&&console.warn("This browser already supports <dialog>, the polyfill may not work correctly",a);if("dialog"!==a.localName)throw Error("Failed to register dialog: The element is not a dialog.");
new w(a)},registerDialog:function(a){a.showModal||d.forceRegisterDialog(a)},DialogManager:function(){this.pendingDialogStack=[];var a=this.checkDOM_.bind(this);this.overlay=document.createElement("div");this.overlay.className="_dialog_overlay";this.overlay.addEventListener("click",function(b){this.forwardTab_=void 0;b.stopPropagation();a([])}.bind(this));this.handleKey_=this.handleKey_.bind(this);this.handleFocus_=this.handleFocus_.bind(this);this.zIndexLow_=1E5;this.zIndexHigh_=100150;this.forwardTab_=
void 0;"MutationObserver"in window&&(this.mo_=new MutationObserver(function(b){var c=[];b.forEach(function(f){for(var g=0,e;e=f.removedNodes[g];++g)e instanceof Element&&("dialog"===e.localName&&c.push(e),c=c.concat(e.querySelectorAll("dialog")))});c.length&&a(c)}))}};d.DialogManager.prototype.blockDocument=function(){document.documentElement.addEventListener("focus",this.handleFocus_,!0);document.addEventListener("keydown",this.handleKey_);this.mo_&&this.mo_.observe(document,{childList:!0,subtree:!0})};
d.DialogManager.prototype.unblockDocument=function(){document.documentElement.removeEventListener("focus",this.handleFocus_,!0);document.removeEventListener("keydown",this.handleKey_);this.mo_&&this.mo_.disconnect()};d.DialogManager.prototype.updateStacking=function(){for(var a=this.zIndexHigh_,b=0,c;c=this.pendingDialogStack[b];++b)c.updateZIndex(--a,--a),0===b&&(this.overlay.style.zIndex=--a);(a=this.pendingDialogStack[0])?(a.dialog.parentNode||document.body).appendChild(this.overlay):this.overlay.parentNode&&
this.overlay.parentNode.removeChild(this.overlay)};d.DialogManager.prototype.containedByTopDialog_=function(a){for(;a=p(a);){for(var b=0,c;c=this.pendingDialogStack[b];++b)if(c.dialog===a)return 0===b;a=a.parentElement}return!1};d.DialogManager.prototype.handleFocus_=function(a){var b=a.composedPath?a.composedPath()[0]:a.target;if(!this.containedByTopDialog_(b)&&document.activeElement!==document.documentElement&&(a.preventDefault(),a.stopPropagation(),r(b),void 0!==this.forwardTab_))return a=this.pendingDialogStack[0],
a.dialog.compareDocumentPosition(b)&Node.DOCUMENT_POSITION_PRECEDING&&(this.forwardTab_?a.focus_():b!==document.documentElement&&document.documentElement.focus()),!1};d.DialogManager.prototype.handleKey_=function(a){this.forwardTab_=void 0;if(27===a.keyCode){a.preventDefault();a.stopPropagation();a=new m("cancel",{bubbles:!1,cancelable:!0});var b=this.pendingDialogStack[0];b&&l(b.dialog,a)&&b.dialog.close()}else 9===a.keyCode&&(this.forwardTab_=!a.shiftKey)};d.DialogManager.prototype.checkDOM_=function(a){this.pendingDialogStack.slice().forEach(function(b){-1!==
a.indexOf(b.dialog)?b.downgradeModal():b.maybeHideModal()})};d.DialogManager.prototype.pushDialog=function(a){if(this.pendingDialogStack.length>=(this.zIndexHigh_-this.zIndexLow_)/2-1)return!1;1===this.pendingDialogStack.unshift(a)&&this.blockDocument();this.updateStacking();return!0};d.DialogManager.prototype.removeDialog=function(a){a=this.pendingDialogStack.indexOf(a);-1!==a&&(this.pendingDialogStack.splice(a,1),0===this.pendingDialogStack.length&&this.unblockDocument(),this.updateStacking())};
d.dm=new d.DialogManager;d.formSubmitter=null;d.imagemapUseValue=null;if(void 0===window.HTMLDialogElement){var h=document.createElement("form");h.setAttribute("method","dialog");if("dialog"!==h.method&&(h=Object.getOwnPropertyDescriptor(HTMLFormElement.prototype,"method"))){var z=h.get;h.get=function(){return q(this)?"dialog":z.call(this)};var A=h.set;h.set=function(a){return"string"===typeof a&&"dialog"===a.toLowerCase()?this.setAttribute("method",a):A.call(this,a)};Object.defineProperty(HTMLFormElement.prototype,
"method",h)}document.addEventListener("click",function(a){d.formSubmitter=null;d.imagemapUseValue=null;if(!a.defaultPrevented){var b=a.target;"composedPath"in a&&(b=a.composedPath().shift()||b);if(b&&q(b.form)){if(!("submit"===b.type&&-1<["button","input"].indexOf(b.localName))){if("input"!==b.localName||"image"!==b.type)return;d.imagemapUseValue=a.offsetX+","+a.offsetY}p(b)&&(d.formSubmitter=b)}}},!1);document.addEventListener("submit",function(a){var b=a.target;if(!p(b)){var c=v(a);"dialog"===(c&&
c.getAttribute("formmethod")||b.getAttribute("method"))&&a.preventDefault()}});var B=HTMLFormElement.prototype.submit;HTMLFormElement.prototype.submit=function(){if(!q(this))return B.call(this);var a=p(this);a&&a.close()}}return d});